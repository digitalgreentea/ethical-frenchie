{{ define "main" }}
  {{ partial "header.html" . }}
  <main class="puppies">
    <section class="pup-feed">
      <div class="row">
        {{ $sec := ($.Site.GetPage "section" "puppies").Pages }}
        {{ range $elem_index, $elem_val := $sec }}
          {{ if or (eq $elem_index 0) (eq $elem_index 1) }}
            {{ .Render "li" }}
          {{ end }}
        {{ end }}
      </div>
      <div class="divider"></div>
      <div class="row">
        {{ range $elem_index, $elem_val := $sec }}
          {{ if or (eq $elem_index 2) (eq $elem_index 3) }}
            {{ .Render "li" }}
          {{ end }}
        {{ end }}
      </div>
    </section>
    <section class="instant-wrap"></section>
  </main>
  {{ partial "footer.html" . }}
{{ end }}
{{ define "scripts" }}
<script>
    var getHTML = (url, callback) => {
    // Feature detection
    if ( !window.XMLHttpRequest ) return;
    // Create new request
    var xhr = new XMLHttpRequest();
    // Setup callback
    xhr.onload = function() {
      if ( callback && typeof( callback ) === 'function' ) {
        callback( this.responseXML );
      }
    }
    // Get the HTML
    xhr.open( 'GET', url );
    xhr.responseType = 'document';
    xhr.send();
  };
  // Fetch and appen instant articles
  let instant = document.querySelector('section.instant-wrap')
  {{ range .Pages }}
  {{ $link := replaceRE " " "-" (.Title | lower) }}
  getHTML('/puppies/{{ $link }}',(response) => {
    const post = response.querySelector('article.post.instant')
    instant.append(post)
    // Update Lazy Loader to initialize after articles are fetched
    myLazyLoad.update()
  });
  {{ end }}

  // Activate instant articles on click
  let openArtLink = document.querySelectorAll('a.button.instant')
  openArtLink.forEach(link => {
    link.removeAttribute('href')
    link.addEventListener('click', () => {
      const data = link.getAttribute('data-instant')
      const instArt = document.querySelector('article#'+data)
      instant.classList.add('active')
      instArt.classList.add('active')
    })
  })

  // Close instant articles
  var closeInst = name => {
    const instArt = document.querySelector('article#'+name)
    instant.classList.remove('active')
    setTimeout(() => {
      instArt.classList.remove('active')
    }, 250);
  }
</script>
{{ end }}